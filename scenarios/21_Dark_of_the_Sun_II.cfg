#textdomain wesnoth-A_Song_of_the_Winds
[scenario]
    id=21_Dark_of_the_Sun_II
    name= _ "Dark of the Sun, part II"
    next_scenario=22_Dark_of_the_Sun_III
    map_data="{~add-ons/A_Song_of_the_Winds/maps/21_Dark_of_the_Sun_II.map}"
    victory_when_enemies_defeated=no
    {TURNS 30 28 26}
    {MIDNIGHT}

    {WEAPON_SPECIALS_EVENTS}
    {SEKMET_TRANSFORMATION}

    {SCENARIO_MUSIC the_dangerous_symphony.ogg}

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Find everyone"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Hathor"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Deianira"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    {STARTING_VILLAGES 1 3}

    [side]
        {MAAT}
        recruit=Weaver ASotW,Courier,Seeker,Gatekeeper,Scribe
        {GOLD 170 150 130}
        {INCOME 15 10 5}
        shroud=yes
        team_name=windsong
        user_team_name=_"Hiera'Shirsha"

        {FLAG_VARIANT long}
    [/side]

    [side]
        no_leader=yes
        side=2
        recruit=Elvish Sun Hero,Elvish Sun Marksman,Elvish Sun Druid,Elvish Sun Sorceress
        team_name=elves
        user_team_name=_"Solariel"
        fog=yes
        gold=0
        income=0
        [ai]
            recruitment_pattern=fighter,fighter,fighter,archer,mixed fighter,healer
            aggression=9.0
        [/ai]
        {FLAG_VARIANT wood-elvish}
    [/side]

#define FOUND_ABHAI

    [unstore_unit]
        variable=abhai_store
        x=30
        y=32
        find_vacant=yes
    [/unstore_unit]
    {CLEAR_VARIABLE abhai_store}

    [redraw][/redraw]

    [message]
        speaker=Abhai
        message= _ "Ugh... (chuckles) Just wait until I tell Maat that you two going beach-hunting while we risked ourselves turned out to be our salvation."
    [/message]
    [message]
        speaker=Deianira
        message= _ "If you can jest about it, I'll take you're doing just fine."
    [/message]
    [message]
        speaker=Hathor
        message= _ "Abhai, do you know where my sister and Raika are? Or just whatever on the Nine Hells is going on here?"
    [/message]
    [message]
        speaker=Abhai
        message= _ "If she isn't here, then my guess is that she's in the Star Palace. I see you've freed the other Windsong, so I don't think I can tell anything you don't know already... Except, maybe, that Lord Yngwi and Lady Sunna are behind everything."
    [/message]
    [message]
        speaker=Deianira
        message= _ "Ugh, don't tell me they're just another bunch seeking revenge on us for Ashura?"
    [/message]
    [message]
        speaker=Abhai
        message= _ "I don't think it's that simple. Lord Yngwi kept saying that the convergence we found in the catacombs was affecting her; that was why we hurried to close it. While we were down there, I noticed his warriors barely advanced. Then it all turns out to be a trap... It could be a coincidence, or else everything is connected."
    [/message]
    [message]
        speaker=Hathor
        message= _ "We won't learn anything new discussing here! Let's go to the Star Palace – the whole island must be up in arms by now, so even reaching it will cost us a lot of time!"
    [/message]
    [message]
        speaker=Abhai
        message= _ "Wait! Before we go, we should look for a cell further down this hallway. I heard the sentinels whispering about whatever – or whoever – lies behind it. Probably they thought that, since I'm human, I wouldn't understand their speech; too bad for them that the royalty of Garet-Desh learns high elven even before Aragwaithi."
    [/message]
    [message]
        speaker=Hathor
        message= _ "And how does that concern us?"
    [/message]
    [message]
        speaker=Abhai
        message= _ "This is a wild guess, but what if that door hides some of the answers we seek? Even if we do reach the Star Palace I don't believe Lord Yngwi will simply welcome us and explain everything. On the other hand, if we uncover something he doesn't expect us to we could gain some edge over him."
    [/message]
    [message]
        speaker=Deianira
        message= _ "I'm surprised at myself for saying this, but... Maybe we should follow his suggestion?"
    [/message]
    [message]
        speaker=Hathor
        message= _ "(sigh) Fine – but let's be quick about it!"
    [/message]

    [objectives]
        side=1
        [objective]
            description= _ "Unlock the gate at the end of the hallway"
            condition=win
        [/objective]
        [objective]
            description= _ "Death of Hathor"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Deianira"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Abhai"
            condition=lose
        [/objective]

        {TURNS_RUN_OUT}

        [gold_carryover]
            bonus=yes
            carryover_percentage=40
        [/gold_carryover]
    [/objectives]
#enddef

    [event]
        name=prestart

        [recall]
            id=Hathor
            x=15
            y=36
        [/recall]

        [recall]
            id=Deianira
            x=17
            y=36
        [/recall]

        [modify_unit]
            [filter]
                id=Hathor
            [/filter]
            [filter_recall]
                race=windsong,merfolk,troll,dwarf,elf
            [/filter_recall]
        [/modify_unit]

        [store_unit]
            [filter]
                id=Maat
            [/filter]
            variable=maat_temp_store
            kill=yes
        [/store_unit]

        {LOYAL_UNIT 2 (Elvish Sun Captain) 7 30} {GUARDIAN}
        {LOYAL_UNIT 2 (Elvish Sun Captain) 27 29} {GUARDIAN}
        {LOYAL_UNIT 2 (Elvish Sun Captain) 7 21} {GUARDIAN}
        {LOYAL_UNIT 2 (Elvish Sun Captain) 26 21} {GUARDIAN}
        {LOYAL_UNIT 2 (Elvish Sun Captain) 8 12} {GUARDIAN}
        {LOYAL_UNIT 2 (Elvish Sun Captain) 24 12} {GUARDIAN}

        {NAMED_LOYAL_UNIT 2 (Elvish Sun Druid) 9 26 (Talyen) ("Talyen")} {GUARDIAN}
        {NAMED_LOYAL_UNIT 2 (Elvish Sun Champion) 23 26 (Githral) ("Githral")} {GUARDIAN}
        {NAMED_LOYAL_UNIT 2 (Elvish Sun Enchantress) 6 16 (Saradith) ("Saradith")} {GUARDIAN}
        {NAMED_LOYAL_UNIT 2 (Ancient Wose) 16 23 (SunGuardian) ("Sun's Guardian")} {GUARDIAN}

        {VARIABLE talyen_spared 0}
        {VARIABLE talyen_killed 0}
        {VARIABLE sunguardian_killed 0}
        {VARIABLE moonwater_collected 0}
    [/event]

    [event]
        name=start

        [if]
            [variable]
                name=storm_sentinels_defeated
                numerical_equals=1
            [/variable]
            [then]
                [teleport]
                    [filter]
                        id=Hathor
                    [/filter]
                    x,y=15,4
                    animate=no
                [/teleport]
                [teleport]
                    [filter]
                        id=Deianira
                    [/filter]
                    x,y=17,4
                    animate=no
                [/teleport]

                {LOYAL_UNIT 2 (Elvish Sun Captain) 5 8} {GUARDIAN}
                {LOYAL_UNIT 2 (Elvish Sun Captain) 26 8} {GUARDIAN}

                [place_shroud]
                    side=1
                    x=4-27
                    y=27-37
                [/place_shroud]

                [redraw][/redraw]
            [/then]
        [/if]

        [message]
            speaker=Deianira
            message= _ "Right, now can you sense where exactly our sisters are? Might not be a good idea to wander aimlessly here – there are certainly guards everywhere in here."
        [/message]
        [message]
            speaker=Hathor
            message= _ "I can... They're all in a dungeon somewhere around the centre and west of the fortress, but... Where are Maat and Raika...?"
        [/message]
        [message]
            speaker=Deianira
            message= _ "I can move faster and more silently, so I'll scout ahead and check the cells."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=9
            y=30
        [/filter]

        [message]
            speaker=unit
            message= _ "This looks promising..."
        [/message]
        [terrain]
            x=10
            y=29
            terrain=Rr^Pr\o
        [/terrain]
        [redraw]
        [/redraw]
        [message]
            speaker=narrator
            message= _ "<i>click!</i>"
        [/message]
        [message]
            speaker=Deianira
            message= _ "Well that was easy... The Solariel don't seem to put much effort in keeping their prisoners locked."
        [/message]
        [message]
            speaker=Hathor
            message= _ "Or perhaps they make sure their prisoners are left in no condition to escape even if they want to."
        [/message]
        [message]
            speaker=Deianira
            message= _ "Girlfriend, the situation is ominous enough without you saying these things..."
        [/message]
    [/event]

    [event]
        name=sighted,moveto
        [filter]
            id=Githral
            [filter_vision]
                side=1
            [/filter_vision]
        [/filter]

        [message]
            speaker=Githral
            message= _ "You shouldn't have escaped the safety of your cells, Windsong..."
        [/message]
    [/event]

    [event]
        name=sighted,moveto
        [filter]
            id=Saradith
            [filter_vision]
                side=1
            [/filter_vision]
        [/filter]

        [message]
            speaker=Saradith
            message= _ "How did you...?! No matter; consider yourselves fortunate it is I, and not a wielder of cold steel, who stands to stop you, Windsong!"
        [/message]
    [/event]

    [event]
        name=sighted,moveto
        [filter]
            id=Talyen
            [filter_vision]
                side=1
            [/filter_vision]
        [/filter]

        [message]
            speaker=Talyen
            message= _ "(annoyed) I told you already, it is going to take some time... (suddenly shocked) Oh...!"
        [/message]
        [message]
            speaker=Deianira
            message= _ "I wonder what a druid is doing as a warden... Perhaps she was just trying to tend to our sisters?"
        [/message]
        [message]
            speaker=Hathor
            message= _ "..."

            [option]
                message= _ "Or maybe she was torturing them with thorns and snares..."
                [command]
                    [message]
                        speaker=Talyen
                        message= _ "You b-barbarians! I fall, but I shall make you bleed first!"
                    [/message]

                    [set_variable]
                        name=talyen_killed
                        value=1
                    [/set_variable]
                [/command]
            [/option]
            [option]
                message= _ "Perhaps we can afford sparing a healer... This time."
                [command]
                    [message]
                        speaker=Talyen
                        message= _ "I-I thank you for your mercy... As a token of gratitude, I'll tell you this: your male companion, the prince, is in a special cell east of here."
                    [/message]
                    [message]
                        speaker=Hathor
                        message= _ "And shall we find it as easy to open his cell as it was opening this one? Recall that I'm a Windsong, and we can tell a liar as easily as black and white."
                    [/message]
                    [message]
                        speaker=Talyen
                        message= _ "Ugh... Fine, you may unlock his cell's gate by sprinkling it with moon water... Here, I have a vial of it, now please, let me keep my life!"
                    [/message]
                    [message]
                        speaker=Deianira
                        message= _ "'Sprinkling it with water'? Really?"
                    [/message]
                    [message]
                        speaker=Talyen
                        message= _ "Our gates are made of sunwood, its branches and roots lock together so that not even the heaviest blows can bring them down. But moon water's special properties can unlock them as easily as any key. Surely <i>you</i> can see I'm telling the truth?"
                    [/message]
                    [message]
                        speaker=Hathor
                        message= _ "That I can't deny... Run like the wind, little druid, and don't stay and wait to see what's going to happen next."
                    [/message]

                    [set_variable]
                        name=moonwater_collected
                        value=1
                    [/set_variable]

                    [set_variable]
                        name=talyen_spared
                        value=1
                    [/set_variable]

                    {MOVE_UNIT id=Talyen 11 18}

                    [message]
                        speaker=Deianira
                        message= _ "Now, let's check what she was doing inside that keep..."
                    [/message]

                    [kill]
                        id=Talyen
                    [/kill]
                [/command]
            [/option]
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=4,5
            y=28,29
        [/filter]

        [terrain]
            x=4
            y=29
            terrain=Rr^Pr\o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "There doesn't seem to be anyone in here..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=8,9
            y=19,19
        [/filter]

        [terrain]
            x=8
            y=18
            terrain=Rr^Pr/o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "There doesn't seem to be anyone in here..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=6,6
            y=7,6
        [/filter]

        [terrain]
            x=6
            y=5
            terrain=Rr^Pr/o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "Careful..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=25,26
            y=6,6
        [/filter]

        [terrain]
            x=26
            y=5
            terrain=Rr^Pr\o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "There doesn't seem to be anyone in here..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=23,24
            y=19,19
        [/filter]

        [terrain]
            x=24
            y=18
            terrain=Rr^Pr\o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "There doesn't seem to be anyone in here..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=23
            y=30
        [/filter]

        [terrain]
            x=22
            y=29
            terrain=Rr^Pr/o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "Careful, there seems to be movement in here..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            [filter_location]
                x=9
                y=26
                radius=1
            [/filter_location]
        [/filter]

        [role]
            type=Windsong Librarian,Arbiter,Oathkeeper,Warmonger,Heretic,Lorekeeper,Savant,Dreadnought,Reaver
            role=Imprisoned
        [/role]
        [recall]
            role=Imprisoned
            x=9
            y=26
        [/recall]

        [message]
            role=Imprisoned
            message= _ "H-Hathor...? Deianira...?"
        [/message]
        [message]
            speaker=Hathor
            message= _ "It's one of our sisters!"
        [/message]
        [message]
            speaker=Deianira
            message= _ "How are you? Did they wound you too much?"
        [/message]
        [message]
            role=Imprisoned
            message= _ "Well, they kept us ensnared in their thorny vines, every now and then tightening them a bit more, but if you asked them I'm sure they'd say we 'wounded ourselves' by resisting."
        [/message]
        [if]
            [variable]
                name=talyen_spared
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Deianira
                    message= _ "And we let that bastard go...!"
                [/message]
                [message]
                    speaker=Hathor
                    message= _ "We'll probably meet her on the battlefield later; what matters is that we got valuable information from her."
                [/message]
            [/then]
        [/if]
        [if]
            [variable]
                name=talyen_killed
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Deianira
                    message= _ "And here I was starting to feel a bit bad about killing that bastard..."
                [/message]
            [/then]
        [/if]
        [message]
            role=Imprisoned
            message= _ "In any case, I am now well, and so should be the rest of our sisters. The others are further down this dungeon; we still don't understand exactly what is going on, but if you say we must fight, we fight."
        [/message]
        [message]
            speaker=Hathor
            message= _ "So you don't know what happened either? Deni and I were left behind on the docks, all we know is you went into some crypt at King Yngwi's request and never returned."
        [/message]
        [message]
            role=Imprisoned
            message= _ "So we did; Yngwi wanted us to cleanse the Solariel's crypt of strange wraiths. We were about to finish them off when everything went dark... That was right after Herald Maat and Lady Raika said something about a terrible presence descending into the crypts."
        [/message]
        [message]
            speaker=Deianira
            message= _ "This is getting more and more ominous... Come, we still have the lordling in distress to find."
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Find Abhai"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Hathor"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Deianira"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            note= _ "NOTE: For the remainder of this scenario and the next, Hathor may recruit/recall."

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            [filter_location]
                x=16
                y=23
                radius=4
            [/filter_location]
        [/filter]

        [message]
            speaker=Deianira
            message= _ "Eh, count on the elves to build a little garden inside a <i>prison</i>."
        [/message]
        [message]
            speaker=Hathor
            message= _ "This isn't just a garden, Deni..."
        [/message]
        [message]
            speaker=SunGuardian
            message= _ "Thou..."
        [/message]
        [message]
            speaker=Deianira
            message= _ "Uh-oh..."
        [/message]
        [message]
            speaker=SunGuardian
            message= _ "...are NOT of the fey folk...! Thou shall feed the earth beneath my roots!"
        [/message]
    [/event]

    [event]
        name=die

        [filter]
            id=SunGuardian
        [/filter]

        [set_variable]
            name=sunguardian_killed
            value=1
        [/set_variable]

        [message]
            speaker=Deianira
            message= _ "Right, now we're safe for the moment, can anyone explain how a <i>tree</i> can cause so much damage?!"
        [/message]
        [message]
            speaker=Hathor
            message= _ "That wasn't a tree, but a wose: one of the fey race, and a pretty powerful one too."
        [/message]
        [message]
            speaker=Deianira
            message= _ "Of course it was powerful... Look, it dropped a... key made of mistletoe...?"
        [/message]
        [if]
            [variable]
                name=talyen_spared
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Hathor
                    message= _ "It must be a special key for unlocking Abhai's cell. We already have the moon water, though."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Hathor
                    message= _ "It must be a key for some kind of gate... one that won't open as easily as some of those we've found so far."
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x=27,28
            y=30,29
        [/filter]
        [if]
            [not]
                [have_unit]
                    id=Abhai
                [/have_unit]
            [/not]
            [then]
                [if]
                    [variable]
                        name=moonwater_collected
                        numerical_equals=0
                    [/variable]
                    [variable]
                        name=sunguardian_killed
                        numerical_equals=0
                    [/variable]
                    [then]
                        [message]
                            speaker=unit
                            message= _ "A gate of intertwining branches and roots... It may seem fragile, but no attack I land on it seems to cause any actual damage."
                        [/message]
                        [message]
                            speaker=Hathor
                            message= _ "Damn it, we have no time to be looking around solving puzzles!"
                        [/message]
                        [message]
                            speaker=Deianira
                            message= _ "We have no choice; Abhai, Maat or Raika might be behind this gate. Let's look around, there must be a way of opening it somewhere..."
                        [/message]
                    [/then]
                    [elseif]
                        [variable]
                            name=moonwater_collected
                            numerical_equals=1
                        [/variable] 
                        [then]
                            [message]
                                speaker=unit
                                message= _ "A gate of intertwining branches and roots... It may seem fragile, but no attack I land on it seems to cause any actual damage."
                            [/message]
                            [message]
                                speaker=Hathor
                                message= _ "That must be one of the sunwood gates. Throw some moon water on it..."
                            [/message]
                            [message]
                                speaker=narrator
                                message= _ "The gates are sprinkled with some of the mysterious water..."
                            [/message]

                            [terrain]
                                x=28
                                y=30
                                terrain=Rr^Pw/o
                            [/terrain]
                            [redraw]
                            [/redraw]

                            {FOUND_ABHAI}

                            [set_variable]
                                name=moonwater_collected
                                value=2
                            [/set_variable]
                            [set_variable]
                                name=sunguardian_killed
                                value=2
                            [/set_variable]
                        [/then]
                        [elseif]
                            [variable]
                                name=sunguardian_killed
                                numerical_equals=1
                            [/variable]
                            [then]
                                [message]
                                    speaker=unit
                                    message= _ "A gate of intertwining branches and roots... It may seem fragile, but no attack I land on it seems to cause any actual damage."
                                [/message]
                                [message]
                                    speaker=Hathor
                                    message= _ "Try the mistletoe key we found with that wose."
                                [/message]
                                [message]
                                    speaker=narrator
                                    message= _ "The key fits easily into the twisting branches..."
                                [/message]

                                [terrain]
                                    x=28
                                    y=30
                                    terrain=Rr^Pw/o
                                [/terrain]
                                [redraw]
                                [/redraw]

                                {FOUND_ABHAI}

                                [set_variable]
                                    name=moonwater_collected
                                    value=2
                                [/set_variable]
                                [set_variable]
                                    name=sunguardian_killed
                                    value=2
                                [/set_variable]
                            [/then]
                        [/elseif]
                    [/elseif]
                [/if]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=31
            y=30
        [/filter]

        [terrain]
            x=31
            y=29
            terrain=Rr^Pw|o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=unit
            message= _ "Careful..."
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=31
            y=26
        [/filter]

        [terrain]
            x=31
            y=25
            terrain=Rr^Pw|o
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker=Abhai
            message= _ "Someone's in there..."
        [/message]

        [remove_shroud]
            side=1
            x=29-33
            y=20-24
        [/remove_shroud]

        [unit]
            {SUNNA}
            animate=yes
            x=31
            y=23
            side=1
        [/unit]

        [redraw][/redraw]

        [message]
            speaker=Abhai
            message= _ "...an elf!"
        [/message]
        [message]
            speaker=Sunna
            message= _ "(weakly) A human, here...? (straightening up) It is no mere elf you speak to, whoever-you-are. I am Sunna, Queen of the Solariel!"
        [/message]
        [message]
            speaker=Abhai
            message= _ "Queen Sunna? But I was told you were ill...!"
        [/message]
        [message]
            speaker=Deianira
            message= _ "And more importantly, why is the Solariel Queen in a dungeon?"
        [/message]
        [message]
            speaker=Sunna
            message= _ "Argh, I see the pretender sits on the throne still... 'Tis a long story, humans; just take me to the Star Palace with haste – there all shall be revealed."
        [/message]
        [message]
            speaker=Hathor
            message= _ "Not so soon, 'Queen'. Your elves have betrayed us, kidnapped my sisters and are even now bent on killing us. The only reason we wasted time searching this secret tunnel was because we thought we could find some answers inside – and so you will explain us what in all Nine Hells is wrong with this island!"
        [/message]
        [message]
            speaker=Sunna
            message= _ "I see you are Windsong... You are right, this is something you <i>should</i> know, if only to take responsibility for. This 'queen' you have been told about was our High Sun Sorceress, Monelys. She was versed in the secret Solariel arts like no other, and possibly for that very reason Ashura the Demon kidnapped her. Monelys was precious to us, so much so that we massed our full might to rescue her. Yet we were too late: she never told us details of her captivity, but something happened that twisted her into something grim. It took me years to notice and even longer to accept that – and by the time I did, Monelys had already ensorceled my people, my priestesses, even my husband..."
        [/message]
        [message]
            speaker=Hathor
            message= _ "That certainly explains much... Let's get out of here; if Monelys is an adept of Ashura, I don't even want to think what she must be doing to Maat and Raika!"
        [/message]
        [if]
            [have_unit]
                id=Isorfilad
            [/have_unit]
            [then]
                [message]
                    speaker=Deianira
                    message= _ "We need to defeat that marshal first!"
                [/message]

                [objectives]
                    side=1
                    [objective]
                        description= _ "Defeat Isorfilad"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Hathor"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Deianira"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Abhai"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Sunna"
                        condition=lose
                    [/objective]

                    {TURNS_RUN_OUT}

                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]
            [/then]
            [else]
                [message]
                    speaker=Deianira
                    message= _ "The way out should be clear now, let's go!"
                [/message]
                [message]
                    speaker=Abhai
                    message= _ "Queen, you should know that the whole island must be aware that the dungeons have been broken, and so more elves must be waiting for us outside."
                [/message]
                [message]
                    speaker=Sunna
                    message= _ "As I said, we must not let anyone or anything stop us; Monelys alone is to blame for this tragedy, and she alone shall suffer for all lives lost tonight!"
                [/message]

                [unstore_unit]
                    variable=maat_temp_store
                    x=2
                    y=2
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE maat_temp_store}

                [endlevel]
                    result=victory
                    bonus=yes
                    carryover_report=no
                    linger_mode=no
                    {NEW_GOLD_CARRYOVER 40}
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=turn 3

        [if]
            [variable]
                name=storm_sentinels_defeated
                numerical_equals=1
            [/variable]
            [then]
                [unit]
                    type=Elvish Sun Marshal
                    side=2
                    x,y=16,2
                    id=Isorfilad
                    name=_ "Marshal Isorfilad"
                    canrecruit=yes
                [/unit]

                {GENERIC_UNIT 2 (Elvish Sun Hero) 15 4}
                {GENERIC_UNIT 2 (Elvish Sun Hero) 17 4}
                {GENERIC_UNIT 2 (Elvish Sun Marksman) 15 6}
                {GENERIC_UNIT 2 (Elvish Sun Marksman) 17 6}

                [modify_side]
                    side=2
                    {GOLD 350 400 450}
                    {INCOME 8 14 20}
                [/modify_side]

                [message]
                    speaker=Isorfilad
                    message= _ "By the Light, they butchered everyone...! Sun Elves, unsheathe your swords and ready your arrows: the cursed Windsong shall not pass!"
                [/message]
                [message]
                    speaker=Hathor
                    message= _ "Curses, they arrived too soon!"
                [/message]
                [message]
                    speaker=Deianira
                    message= _ "Um, perhaps we <i>really</i> should've tried the subtle approach when entering this fortress..."
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=turn 6

        [if]
            [not]
                [have_unit]
                    id=Isorfilad
                [/have_unit]
            [/not]
            [then]
                [unit]
                    type=Elvish Sun Marshal
                    side=2
                    x,y=16,2
                    id=Isorfilad
                    name=_ "Marshal Isorfilad"
                    canrecruit=yes
                [/unit]

                {GENERIC_UNIT 2 (Elvish Sun Hero) 15 4}
                {GENERIC_UNIT 2 (Elvish Sun Hero) 17 4}
                {GENERIC_UNIT 2 (Elvish Sun Marksman) 15 6}
                {GENERIC_UNIT 2 (Elvish Sun Marksman) 17 6}

                [modify_side]
                    side=2
                    {GOLD 350 400 450}
                    {INCOME 8 14 20}
                [/modify_side]

                [message]
                    speaker=Isorfilad
                    message= _ "I can hear sounds of struggle deeper in the hallways. Sun Elves, unsheathe your swords and ready your arrows: the cursed Windsong shall not pass!"
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            id=Sunna
            [filter_location]
                x=16
                y=2
                radius=7
            [/filter_location]
        [/filter]

        [message]
            speaker=Sunna
            message= _ "Isorfilad, hold your warriors – 'tis I, your true queen, who commands you so!"
        [/message]
        [message]
            speaker=Isorfilad
            message= _ "(stunned) This voice...!"
        [/message]
        [delay]
            time=1000
        [/delay]
        [message]
            speaker=Isorfilad
            message= _ "(re-composing) No, this cannot be so... You, imposter! You side with elf-murderers, and so you shall be butchered as one!"
        [/message]
        [message]
            speaker=Sunna
            message= _ "Curse you, Monelys...! Her spell has naturally gotten even stronger after sixteen decades. We have no choice now: Windsong, cut them down! We must not allow anyone or anything get in our way, for the Solariel's own sake! And may the First comfort their souls..."
        [/message]
    [/event]

    [event]
        name=last breath

        [filter]
            id=Isorfilad
        [/filter]

        [message]
            speaker=Isorfilad
            message= _ "I have failed you... my Queen..."
        [/message]
        [message]
            speaker=Sunna
            message= _ "Rest with the Fey, poor Isorfilad."
        [/message]
    [/event]

    [event]
        name=die

        [filter]
            id=Isorfilad
        [/filter]
        [if]
            [have_unit]
                id=Sunna
            [/have_unit]
            [then]
                [message]
                    speaker=Deianira
                    message= _ "The way out should be clear now, let's go!"
                [/message]
                [message]
                    speaker=Abhai
                    message= _ "Queen, you should know that the whole island must be aware that the dungeons have been broken, and so more elves must be waiting for us outside."
                [/message]
                [message]
                    speaker=Sunna
                    message= _ "As I said, we must not let anyone or anything stop us; Monelys alone is to blame for this tragedy, and she alone shall suffer for all lives lost tonight!"
                [/message]

                [unstore_unit]
                    variable=maat_temp_store
                    x=2
                    y=2
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE maat_temp_store}

                [endlevel]
                    result=victory
                    bonus=yes
                    carryover_report=no
                    linger_mode=no
                    {NEW_GOLD_CARRYOVER 40}
                [/endlevel]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            x=16
            y=1
            id=Hathor
        [/filter]
        [if]
            [have_unit]
                id=Sunna
            [/have_unit]
            [then]
                [message]
                    speaker=Hathor
                    message= _ "At last! This way, everyone!"
                [/message]
                [message]
                    speaker=Deianira
                    message= _ "Queen, you should know that the whole island must be aware that we broke into the dungeons, and so more elves must be waiting for us outside."
                [/message]
                [message]
                    speaker=Sunna
                    message= _ "As I said, we must not let anyone or anything stop us; Monelys alone is to blame for this tragedy, and she alone shall suffer for all lives lost tonight!"
                [/message]

                [unstore_unit]
                    variable=maat_temp_store
                    x=2
                    y=2
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE maat_temp_store}

                [endlevel]
                    result=victory
                    bonus=yes
                    carryover_report=no
                    linger_mode=no
                    {NEW_GOLD_CARRYOVER 40}
                [/endlevel]
            [/then]
            [else]
                [message]
                    speaker=Abhai
                    message= _ "We still need to investigate that cell!"
                [/message]
            [/else]
        [/if]
    [/event]

    [event]
        name=victory
        {CLEAR_VARIABLE moonwater_collected}
        {CLEAR_VARIABLE storm_sentinels_defeated}
        {CLEAR_VARIABLE sunguardian_killed}
        {CLEAR_VARIABLE talyen_killed}
        {CLEAR_VARIABLE talyen_spared}
    [/event]

    {HEROES_LAST_BREATHS_SECOND}

    [event]
        name=last breath
        [filter]
            id=Sunna
        [/filter]

        [message]
            speaker=Sunna
            message= _ "What a pathetic way to die..."
        [/message]
        [message]
            speaker=Abhai
            message= _ "No! We needed her alive!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Deianira
            message= _ "Damn it, at this point the entire island must be on alert! We'll never find our sisters now!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
